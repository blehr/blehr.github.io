$(function(){var t=[],e=1,s=0,n=0,o=[],i={start:function(){function e(){t.push(Math.floor(4*Math.random())+1)}!function(){for(var t=0;t<20;t++)e()}()},displayChallenge:function(){this.displayCount(),s=0;for(var n,l=0;l<e;l++)n=t[l],o.push(setTimeout(this.convertToButtonPress(n),800*l));setTimeout(function(){i.enableButtons()},800*e)},delayedDisplayChallenge:function(){i.displayChallenge()},disableButtons:function(){return $(".button").addClass("no-mouse")},enableButtons:function(){return $(".button").removeClass("no-mouse")},convertToButtonPress:function(t){return 1===t?r.playGreen:2===t?r.playRed:3===t?r.playYellow:4===t?r.playBlue:void 0},displayCount:function(){$(".count").val(e)},strictStart:function(){$(".strict").hasClass("strict-on")||$(".strict").addClass("strict-on"),$(".start").hasClass("strict-on")&&$(".start").removeClass("strict-on"),t.length=0,e=1,n=1,i.start(),i.displayChallenge()},checkPress:function(o){o===t[s]?(s++,i.convertToButtonPress(o)(),s===e&&(e++,21===e?(r.displayWin(),$(".count").val("WIN"),i.disableButtons()):(i.disableButtons(),setTimeout(i.delayedDisplayChallenge,1500)))):1===n?(r.playError(),$(".count").val("ERR"),setTimeout(function(){i.strictStart()},2e3)):(r.playError(),$(".count").val("ERR"),setTimeout(i.delayedDisplayChallenge,3e3))},clearAllTimeouts:function(){o.forEach(function(t){clearTimeout(t)})}},l={currentText:function(){return $(".btn-power").text()},onText:"on",offText:"off",switchPower:function(){this.currentText()===this.offText?(e="",$(".btn-power").text(this.onText).toggleClass("power-on"),$(".controls").addClass("no-mouse"),$(".strict").hasClass("strict-on")&&$(".strict").removeClass("strict-on"),$(".start").hasClass("strict-on")&&$(".start").removeClass("strict-on"),i.displayCount(),i.disableButtons(),i.clearAllTimeouts()):($(".btn-power").text(this.offText).toggleClass("power-on"),$(".controls").removeClass("no-mouse"))}},r={playGreen:function(){$(".left-top-green").toggleClass("green-press"),$(".audio-green")[0].play(),setTimeout(function(){$(".left-top-green").toggleClass("green-press")},500)},playRed:function(){$(".right-top-red").toggleClass("red-press"),$(".audio-red")[0].play(),setTimeout(function(){$(".right-top-red").toggleClass("red-press")},500)},playYellow:function(){$(".left-bottom-yellow").toggleClass("yellow-press"),$(".audio-yellow")[0].play(),setTimeout(function(){$(".left-bottom-yellow").toggleClass("yellow-press")},500)},playBlue:function(){$(".right-bottom-blue").toggleClass("blue-press"),$(".audio-blue")[0].play(),setTimeout(function(){$(".right-bottom-blue").toggleClass("blue-press")},500)},error:function(){$(".left-top-green").toggleClass("green-press"),$(".audio-green")[0].play(),setTimeout(function(){$(".left-top-green").toggleClass("green-press")},500),$(".right-top-red").toggleClass("red-press"),setTimeout(function(){$(".right-top-red").toggleClass("red-press")},500),$(".left-bottom-yellow").toggleClass("yellow-press"),setTimeout(function(){$(".left-bottom-yellow").toggleClass("yellow-press")},500),$(".right-bottom-blue").toggleClass("blue-press"),setTimeout(function(){$(".right-bottom-blue").toggleClass("blue-press")},500)},playError:function(){r.error(),setTimeout(function(){r.error()},800),setTimeout(function(){r.error()},1600)},win:function(){this.delayedPress(r.playGreen,1),this.delayedPress(r.playRed,2),this.delayedPress(r.playBlue,3),this.delayedPress(r.playYellow,4)},displayWin:function(){this.win(),setTimeout(function(){r.win()},1500),setTimeout(function(){r.win()},2800)},delayedPress:function(t,e){setTimeout(function(){t()},300*e)}};$(".left-top-green").click(function(){i.checkPress(1)}),$(".right-top-red").click(function(){i.checkPress(2)}),$(".left-bottom-yellow").click(function(){i.checkPress(3)}),$(".right-bottom-blue").click(function(){i.checkPress(4)}),$(".btn-power").click(function(){l.switchPower()}),$(".start").click(function(){$(".strict").hasClass("strict-on")&&$(".strict").removeClass("strict-on"),$(".start").hasClass("strict-on")||$(".start").addClass("strict-on"),t.length=0,e=1,n=0,i.start(),i.displayChallenge()}),$(".strict").click(function(){i.strictStart()}),i.disableButtons()});var ttt=function(){var t,e,s="",n="",o=[["sq1","sq2","sq3"],["sq4","sq5","sq6"],["sq7","sq8","sq9"],["sq1","sq4","sq7"],["sq2","sq5","sq8"],["sq3","sq6","sq9"],["sq1","sq5","sq9"],["sq3","sq5","sq7"]],i=["sq1","sq2","sq3","sq4","sq5","sq6","sq7","sq8","sq9"],l=["sq1","sq3","sq7","sq9"],r=[],a=[],c=[],u="",f="",h='<img src="https://dl.dropboxusercontent.com/u/21809793/toes%20-%20Edited.png" class="ttt-img">',g='<img src="https://dl.dropboxusercontent.com/u/21809793/tick.jpg" class="ttt-img">',p=function(){setTimeout(function(){$(".ttt-notification").animate({height:"300px"},500)},1e3)},d=function(){$(".ttt-notification").animate({height:"0"},500)},m=function(e){t=5,$(".ttt-notify-winner .ttt-text p").html(e),$(".ttt-notify-winner").animate({height:"300px"},500)},y=function(){$(".ttt-notify-winner .ttt-text p").html(""),$(".ttt-notify-winner").animate({height:"0"},500)},q=function(){t=5,$(".ttt-notify-winner .ttt-text p").html("Its a Tie!"),$(".ttt-notify-winner").animate({height:"300px"},500)},C=function(t){i.splice(i.indexOf(t),1),l.indexOf(t)!==-1&&l.splice(l.indexOf(t),1)},T=function(){o.forEach(function(t){c.length=0,a.forEach(function(e){t.indexOf(e)!==-1&&(c.push(e),2===c.length&&t.forEach(function(t){if(c.indexOf(t)===-1&&i.indexOf(t)!==-1)return u=t,!0}))})})},b=function(){o.forEach(function(t){c.length=0,r.forEach(function(e){t.indexOf(e)!==-1&&(c.push(e),2===c.length&&t.forEach(function(t){if(c.indexOf(t)===-1&&i.indexOf(t)!==-1)return f=t,!0}))})})},w=function(s){setTimeout(function(){if(b(),""!==f)e=f;else if(T(),""!==u)e=u;else{var o=Math.floor(Math.random()*(s.length-1-0+1))+0;e=s[o]}r.push(e),C(e),k(r),t=1,$("#"+e).html(n)},1200)},x=function(){0===t&&(0===i.length?q():w(r.length<3?l:i))},v=function(){m(1===t?"You Win!":"You Lose!")},k=function(e){o.forEach(function(t){if(e.indexOf(t[0])!==-1&&e.indexOf(t[1])!==-1&&e.indexOf(t[2])!==-1)return void v()}),0===t&&0===i.length?q():1===t&&(t=0,x())},P=function(){if(1===t){var e=$(this).attr("id");i.indexOf(e)!==-1?($(this).html(s),a.push(e),C(e),k(a),u="",f=""):t=1}},E=function(){s=$(this).data("img"),"tick"===s?(s=g,n=h):(s=h,n=g),d(),t=0,r.length=0,a.length=0,x()},B=function(){$(".square").html(""),i.length=0,l.length=0,i=["sq1","sq2","sq3","sq4","sq5","sq6","sq7","sq8","sq9"],l=["sq1","sq3","sq7","sq9"],u="",f="",r.length=0,a.length=0,t=0,y(),x()};return{showNotification:p,playerTakesTurn:P,playerChooseMark:E,reset:B}}();$(function(){ttt.showNotification(),$(".square").on("click",ttt.playerTakesTurn),$(".x, .o").on("click",ttt.playerChooseMark),$(".ttt-reset").on("click",ttt.reset)});